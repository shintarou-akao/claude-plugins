---
name: pr-review-respond
description: PRのレビューコメントを取得し、指摘事項に対応してコミット・プッシュを行う。
---

# PRレビューコメント対応

PRのレビューコメントを取得し、指摘事項を確認して対応するワークフロー。

## ワークフロー

### 1. PR情報の取得

引数からPR番号またはURLを取得。引数がない場合は現在のブランチに関連するPRを自動検出。

```bash
gh pr view <PR番号またはURL> --json number,url,title,reviews,comments

# コードの行に対するレビューコメントを取得（suggestion含む）
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments
```

### 2. レビューコメントの一覧表示と分析

取得したレビューコメントを整理して表示し、各コメントの妥当性を分析:

- ✅ 妥当な指摘
- ⚠️ 検討が必要
- ❌ 対応不要

### 3. 対応するコメントの選択

AskUserQuestionツールを使用して、対応するコメントをユーザーに選択してもらう（multiSelect: true）。

### 4. コメントごとの対応とコミット

選択されたコメントを1つずつ処理（プッシュはまだ行わない）:

#### 4.1 対応の実施

- 指摘内容を詳細に分析
- 必要なコード修正を実行
- 修正内容をユーザーに説明

#### 4.2 コミット

各コメントの対応完了後、変更をコミットする。

#### 4.3 次のコメントへ

選択されたすべてのコメントに対して4.1〜4.2を繰り返す。

### 5. まとめてプッシュ

すべてのコメント対応が完了したら、まとめてプッシュする。

### 6. PRコメントへの返信

プッシュ完了後、対応した各コメントに返信。

**スレッド返信できる場合は必ずスレッドで返信する**:

```bash
# スレッド返信（レビューコメント）
gh api repos/{owner}/{repo}/pulls/{pr_number}/comments/{comment_id}/replies \
  -f body="返信内容"

# 通常の返信（スレッド返信不可の場合）
gh pr comment <PR番号> --body "返信内容"
```

**返信スタイル**:

- 人間のレビュアー: `@username` でメンション、丁寧な敬語
- AIツール: メンション不要、敬語不要、事実のみ簡潔に

```markdown
# 人間向け
@reviewer ご指摘ありがとうございます！対応いたしました。
修正内容: 〇〇を△△に変更
コミット: abc1234

# AIツール向け
対応した。
**修正内容:** 〇〇を△△に変更
**コミット:** abc1234
```

### 7. 対応しないコメントへの返信

選択されなかったコメントに対して、理由を返信するかユーザーに確認。

```markdown
# 人間向け
@reviewer ご指摘ありがとうございます。
検討しましたが、〇〇のため今回は対応を見送らせていただきます。

# AIツール向け
以下の理由により対応しない。
- 〇〇のため
```
